
```{r setup, echo=FALSE, include=FALSE, cache=FALSE}
# Set up the environment
library(knitr) 
opts_chunk$set(cache.path='cache/', fig.path='img/', cache=F, tidy=T, fig.keep='high', dpi=300, out.width=700, echo=F, autodep=T)
options(replace.assign=TRUE, width=200)
set.seed(1)
```

```{r loadData}
dirs <- list.dirs("data", full.names=T, recursive=F) # Paths the SNP sets analyses
dirs.TAB1 <- dirs[grep("TAB1-", dirs)]
dirs.TAB2 <- dirs[grep("TAB2-", dirs)]
dirs.TAB12 <- dirs[grep("TAB12-", dirs)]

trackDb.hg19 <- read.table("data/trackDb.hg19", sep="\t", header=F, row.names=1)
```

```{r loadLibraries, warning=FALSE, message=FALSE}
library(gridExtra)
source("utils.R")
```

Blau syndrome SNP sets analysis
========================================================

Analysis of individual sets
----------------------------
We analyze 3 sets of SNPs associated with NOD2 pathway in EA and AA populations:
1) `TAB1-AA` - SNPs associated with TAB1 region in AA population.
2) `TAB2-EA` - SNPs associated with TAB2 region in EA population
3) `TAB12-combined` - SNPs associated with Blau syndrome in both populations

The analysis is organized as follows:
1) Each set is tested for enrichmed co-localization in 4498 genome annotation (epigenomic) marks from the Encode project. Top 10 most significant enriched/depleted associations are shown. Look for `1Encode` postfix in the headers.
2) Each set is tested vs. 267 other genome annotation marks. Look for `2other` postfix
3) Each set is further tested for enrichment in custom categories of genomic features. Look for the description of their postfixes in the [FAQ](https://mdozmorov.github.io/grdocs/misc/Faq.html)

P-values are corrected for multiple testing using FDR. For each analysis, only the significant enrichment results (p < 0.01) are shown. Negative p-value indicates depletion. Tables show top 10 or less enriched/depleted associations, barplots visualize the same results. If an analysis does not have any significant results, it is not displayed at all.

TAB12-combined analysis
===========================
This is the most interesting analysis because it contrasts the two conditions. Look at the differences between AA and EA populations.

```{r TAB12}
for (i in (1:length(dirs.TAB1))) {
  mtx <- merge(read.table(paste(dirs.TAB1[i], "matrix.txt", sep="/"), sep="\t", row.names=1, header=T),
               read.table(paste(dirs.TAB2[i], "matrix.txt", sep="/"), sep="\t", row.names=1, header=T), by="row.names")
  rownames(mtx) <- mtx[, 1]; mtx <- mtx[, -1]
  print("---------------------------------------------------------------")
  print(paste(sub("data/TAB12-combined-", "", dirs.TAB1[i]), "analysis"))
  print("---------------------------------------------------------------")
  showTable(mtx)
}
```

TAB1-AA analysis
================

```{r TAB1}
for (i in (1:length(dirs.TAB1))){
  mtx <- read.table(paste(dirs.TAB1[i], "matrix.txt", sep="/"), sep="\t", row.names=1, header=T)
  print("---------------------------------------------------------------")
  print(paste(sub("data/TAB1-AA-", "", dirs.TAB1[i]), "analysis"))
  print("---------------------------------------------------------------")
  showTable(mtx)
}
```

TAB1-EA analysis
================

```{r TAB2}
for (i in (1:length(dirs.TAB2))){
  mtx <- read.table(paste(dirs.TAB1[i], "matrix.txt", sep="/"), sep="\t", row.names=1, header=T)
  print("---------------------------------------------------------------")
  print(paste(sub("data/TAB2-EA-", "", dirs.TAB1[i]), "analysis"))
  print("---------------------------------------------------------------")
  showTable(mtx)
}
```